# Fooocus в Colab: код с GitHub, модели с Яндекс.Диска

Если на Google Drive мало места (например, 15 ГБ), а на **Яндекс.Диске** больше — модели можно хранить на Яндексе и подключать их в Colab через **rclone**.

---

## 1. Код на GitHub

Как и в варианте с Drive: выгрузите код Fooocus на GitHub **без** папок `models`, `venv` (см. `.gitignore`). В Colab клонируем репозиторий.

---

## 2. Модели на Яндекс.Диске

Один раз загрузите папку с моделями на Яндекс.Диск:

- Папку **`models 12.07.29`** (или **`models`**) целиком — ту, где лежат `checkpoints/`, `loras/` и т.д.
- Можно положить в любую папку на диске, например: `Fooocus/models 12.07.29` или `AI-modeli/Fooocus/models 12.07.29`.

Запомните **путь на диске** (без ведущего слеша), например:  
`Fooocus/models 12.07.29` или `AI-modeli/Fooocus/models 12.07.29`.  
Этот путь вы укажете в ноутбуке в переменной **YANDEX_MODELS_PATH**.

---

## 3. Токен rclone для Яндекс.Диска (один раз)

В Colab нет браузера для входа в Яндекс, поэтому токен нужно получить **на своём компьютере** и вставить в ноутбук.

### На вашем компьютере (Mac/Linux)

1. Установите rclone, если ещё нет:  
   **Mac:** `brew install rclone`  
   **Linux:** `sudo apt install rclone` или с [rclone.org](https://rclone.org/).

2. В терминале выполните:
   ```bash
   rclone authorize "yandex"
   ```
3. Откроется браузер, войдите в аккаунт Яндекс и разрешите доступ.
4. В терминале появится **длинная строка** (JSON с `access_token`, `token_type`, `expiry`).  
   **Скопируйте её целиком** — это токен для Colab.

Токен действует несколько месяцев; после истечения нужно снова выполнить `rclone authorize "yandex"` и обновить его в ноутбуке.

---

## 4. Запуск в Colab

1. Откройте [Google Colab](https://colab.research.google.com/).
2. **File → Upload notebook** → выберите **`fooocus_colab_github_yandex.ipynb`**.
3. **Runtime → Change runtime type → GPU** (T4).
4. В первой ячейке укажите:
   - **GITHUB_REPO** — ссылку на ваш репозиторий, например:  
     `https://github.com/ВАШ_ЛОГИН/fooocus.git`
   - **YANDEX_MODELS_PATH** — путь на Яндекс.Диске к папке с моделями, например:  
     `Fooocus/models 12.07.29`
   - **YANDEX_TOKEN** — вставьте скопированный токен. Удобно в **тройных кавычках**:
     ```python
     YANDEX_TOKEN = """{"access_token":"xxx...","token_type":"OAuth","expiry":"2025-..."}"""
     ```
5. Запустите ячейки по порядку.

Ноутбук установит rclone, настроит доступ к Яндекс.Диску по токену, **смонтирует** папку с моделями (через FUSE) и подключит её к Fooocus. В конце будет ссылка вида `https://xxxxx.gradio.live`.

---

## Если монтирование не сработает

В некоторых средах Colab нет FUSE — тогда `rclone mount` может выдать ошибку. В этом случае:

- Можно попробовать другой runtime (Runtime → Disconnect and delete runtime → заново запустить с GPU).
- Альтернатива: скопировать модели с Яндекса в Colab одной командой (займёт время и займёт место на диске Colab, обычно ~100 ГБ):
  ```bash
  rclone copy yandex:YANDEX_MODELS_PATH /content/yandex_models --progress
  ```
  и дальше использовать `/content/yandex_models` как папку с моделями. Объём моделей должен помещаться в лимит диска Colab.

---

## Безопасность

Токен даёт доступ к вашему Яндекс.Диску. Не публикуйте ноутбук с подставленным токеном в открытый доступ. Лучше каждый раз вставлять токен вручную в ячейку перед запуском.
